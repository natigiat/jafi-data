function modalFun(e) {
    function i() {
        var e = r.width();
        if (e <= 767 && (n == "mobile" || n == "desktop")) {
            $(".modal-body").removeClass("desktop-des-non-active");
            $(".modal-body").removeClass("mobile-des-active");
            n = "phone";
            if ($(".smenu-user").find("a").hasClass("active")) {
                $(".smenu-user").find("a").removeClass("active")
            }
        }
        if (e <= 979 && e >= 768 && (n == "desktop" || n == "phone")) {
            $(".modal-body").removeClass("desktop-des-non-active");
            $(".modal-body").removeClass("smenu-active");
            n = "mobile";
            if ($(".smenu-user").find("a").hasClass("active")) {
                $(".smenu-user").find("a").removeClass("active")
            }
        }
        if (n == "desktop") {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera  Mini/i.test(navigator.userAgent)) {
                $(".modal-body").addClass("trigger-mobileDevice");
                $(".modal-body").addClass("mobile-des-active");
                $(".smenu-user").find("a").addClass("active");
                $(".modal-body").addClass("smenu-active");
                $(this).find("a").addClass("active");
                n = "phone";
                $(".mobile-nav").removeClass("visible-phone");
                $(".smenu-close").removeClass("visible-phone");
                $(".modal-header").hide()
            }
        }
        if (e >= 980 && (n == "mobile" || n == "phone")) {
            n = "desktop";
            if ($(".smenu-user").find("a").hasClass("active")) {
                $(".modal-body").removeClass("mobile-des-active");
                $(".modal-body").removeClass("smenu-active")
            } else {
                $(".smenu-user").find("a").addClass("active");
                $(".modal-body").removeClass("desktop-des-non-active")
            }
        }
    }
    
   
    $userMes = $(e).find(".userMes");
    $admin = $(e).find(".admin");
    $shedule = $(e).find(".shedule");
    $adminInfo = $($admin).html();
    $scheduleCon = $($shedule).html();
    $userMessage = $($userMes).html();
    $admin = $($admin).html();
    




    var t = '<div class="modal-overlay" id="modal-overlay"> <div class="modal-wrapper spinner-target"><div class="modal-content"><div class="modal-header hidden-phone"><i class="fa fa-plus-circle addElement"></i><h2 id="addHeader"></h2> <div class="saveB"><section class="elementSave"> <div class="button"> <input type="text" placeholder="Element Name" class="elementName"></div> <div class="cover"> <div class="innie"></div> <div class="spine"></div> <div class="outie"></div> </div> <div class="shadow"></div> </section><i class="fa fa-chevron-right saveElement"></i></div><i class="fa fa-arrows-alt fullScreen"></i><p></p><span class="modal-close">X</span></div><div class="modal-body"><div class="share"></div><div class="modal-left"><ul class="listElement col-sm-11"></ul><div id="mainEditor" style="display:none;"><div id="add-html" class="addEditor ui-widget-content zoomTarget"></div><div id="add-css" class="addEditor ui-widget-content"></div><div id="add-js" class="addEditor ui-widget-content"></div></div><iframe width="100%", height="100%" frameborder="no", scrolling="no", class="Container" src="/result/element"></iframe><div class="modal-menu"> <div class="mobile-nav visible-phone"><a class=""><span><i class="icon-reorder"></i></span></a></div><div class="wrapper-smenu"><ul class="nav"> <li class="smenu-close visible-phone"><a class="" href="#"><i class="icon-remove-sign"></i></a></li><li class="smenu-images"><a class="active" href="#"><i class="icon-pictures3"></i></a></li> <li class="smenu-video"><a class="" href="#"><i class="icon-tv"></i></a></li><li class="smenu-element"><a class="" href="#"><i class="icon-cube"></i></a></li> <li class="smenu-form"><a class="" href="#"><i class="icon-envelope"></i></a></li> <li class="smenu-chat"><a class="" href="#"><i class="icon-comments"></i></a></li><li class="smenu-user"><a class="active" href="#"><i class="icon-user"></i></a></li></ul></div></div></div></div></div></div>'; $("body").append(t); $(".modal-overlay").fadeIn();
    $(".smenu-close").click(function(e) {
        $(".modal-overlay").fadeOut()
    });
    $(".modal-close").click(function(e) {
        $(".modal-overlay").fadeOut()
    });


    $(".smenu-images").on('click' , function(e) {
        $('.wrapper-smenu').find('a').removeClass('active');
        $(this).find('a').addClass('active');
        

        $header = 'images';
        $data = '<section class="filter-wrapper"> <div class="keyword-wrapper"> <input type="text" id="keyword" class="cdnjs" autocomplete="off" placeholder="start typing please..." required /> <a href="https://www.paviliongift.com/search?keyword=" target="_blank" id="keyword-button"><i class="fa fa-search-plus"></i></a> </div> <ul id="filter-select" class="filter-select no-value"> </ul> </section>';
        $('#addHeader').text($header).fadeIn(5000000);
    });

    $(".smenu-video").on("click" , function(e) {
        $('.wrapper-smenu').find('a').removeClass('active');
        $(this).find('a').addClass('active');

        $header= 'video';
        $('#addHeader').text($header).fadeIn(500000000);

        $('.listElement').empty();
        $.post( '/scanner/elements/video', function(data) {
            $.each(data, function(index, val) {
                $('.listElement').append('<li class="templateLi filteTemplate"> <div class="col-sm-4 row listProgect"> <div class="text-center col-sm-12progectName">'+val.name+'</div> <div class="col-sm-12"> <div class="templatesWebsite"></div> <div class="iframe-wrap added"><iframe src="/progect/element/'+val._id +"/" +val.name + '" style="margin: 0 auto; transform-origin: top left;" allowtransparency="true" width="100%" height="220px" frameborder="0" scrolling="no" align="center" class="webform-frame"></iframe></div> </div> <div class="col-sm-12 ratingTemplates"> <div class="col-sm-6"><p class="templatesPrice">Price : Free</p></div> <div class="col-sm-6 pull-right"> <a class="watch" name="watch"><i class="fa fa-eye"></i><span class="eyesValue" val="3">3</span></a> <a class="single-stat comments"><i class="fa fa-heart-o"></i>3</a> </div> </div> <div class="col-sm-12 temlatesButtons"> <a class="btn btn-primary btn-sm fixed-bottom box-shadow--2dp col-sm-6 progectLink elementAdd">Add</a> <a class="btn btn-success btn-sm fixed-bottom box-shadow--4dp col-sm-6 sec" href="/progect/element/'+val._id +"/" +val.name + '">View</a> </div> </div> </li>');
           });
       
        });  
    });

    $(".smenu-element").on("click" , function(e) {
        $('.wrapper-smenu').find('a').removeClass('active');
        $(this).find('a').addClass('active');

        $header= 'element';
        $('#addHeader').text($header);

        if ($('.listElement').css('display') === "none") {
            $('.listElement').show()
        };

        $('.listElement').empty();
        $.post( '/scanner/elements/element', function(data) {
            $.each(data, function(index, val) {
                $('.listElement').append('<li class="templateLi filteTemplate"> <div class="col-sm-4 row listProgect"> <div class="text-center col-sm-12progectName">'+val.name+'</div> <div class="col-sm-12"> <div class="templatesWebsite"></div> <div class="iframe-wrap added"><iframe src="/progect/element/'+val._id +"/" +val.name + '" style="margin: 0 auto; transform-origin: top left;" allowtransparency="true" width="100%" height="220px" frameborder="0" scrolling="no" align="center" class="webform-frame"></iframe></div> </div> <div class="col-sm-12 ratingTemplates"> <div class="col-sm-6"><p class="templatesPrice">Price : Free</p></div> <div class="col-sm-6 pull-right"> <a class="watch" name="watch"><i class="fa fa-eye"></i><span class="eyesValue" val="3">3</span></a> <a class="single-stat comments"><i class="fa fa-heart-o"></i>3</a> </div> </div> <div class="col-sm-12 temlatesButtons"> <a class="btn btn-primary btn-sm fixed-bottom box-shadow--2dp col-sm-6 progectLink elementAdd">Add</a> <a class="btn btn-success btn-sm fixed-bottom box-shadow--4dp col-sm-6 sec" href="/progect/element/'+val._id +"/" +val.name + '">View</a> </div> </div> </li>');
           });
       
        }); 

    });

    $(".smenu-form").on("click" , function(e) {
        $('.wrapper-smenu').find('a').removeClass('active');
        $(this).find('a').addClass('active');

        $header= 'form';
        $('#addHeader').text($header);

        $('.listElement').empty();
        $.post( '/scanner/elements/form', function(data) {
            $.each(data, function(index, val) {
                $('.listElement').append('<li class="templateLi filteTemplate"> <div class="col-sm-4 row listProgect"> <div class="text-center col-sm-12progectName">'+val.name+'</div> <div class="col-sm-12"> <div class="templatesWebsite"></div> <div class="iframe-wrap added"><iframe src="/progect/element/'+val._id +"/" +val.name + '" style="margin: 0 auto; transform-origin: top left;" allowtransparency="true" width="100%" height="220px" frameborder="0" scrolling="no" align="center" class="webform-frame"></iframe></div> </div> <div class="col-sm-12 ratingTemplates"> <div class="col-sm-6"><p class="templatesPrice">Price : Free</p></div> <div class="col-sm-6 pull-right"> <a class="watch" name="watch"><i class="fa fa-eye"></i><span class="eyesValue" val="3">3</span></a> <a class="single-stat comments"><i class="fa fa-heart-o"></i>3</a> </div> </div> <div class="col-sm-12 temlatesButtons"> <a class="btn btn-primary btn-sm fixed-bottom box-shadow--2dp col-sm-6 progectLink elementAdd ">Add</a> <a class="btn btn-success btn-sm fixed-bottom box-shadow--4dp col-sm-6 sec" href="/progect/element/'+val._id +"/" +val.name + '">View</a> </div> </div> </li>');
           });
       
        });  
    });

    $(".smenu-chat").on("click" , function(e) {
        $('.wrapper-smenu').find('a').removeClass('active');
        $(this).find('a').addClass('active');

        $header= 'chat';
        $('#addHeader').text($header);
        
        $('.listElement').empty();
        $.post( '/scanner/elements/chat', function(data) {
            $.each(data, function(index, val) {
                $('.listElement').append('<li class="templateLi filteTemplate"> <div class="col-sm-4 row listProgect"> <div class="text-center col-sm-12progectName">'+val.name+'</div> <div class="col-sm-12"> <div class="templatesWebsite"></div> <div class="iframe-wrap added"><iframe src="/progect/element/'+val._id +"/" +val.name + '" style="margin: 0 auto; transform-origin: top left;" allowtransparency="true" width="100%" height="220px" frameborder="0" scrolling="no" align="center" class="webform-frame"></iframe></div> </div> <div class="col-sm-12 ratingTemplates"> <div class="col-sm-6"><p class="templatesPrice">Price : Free</p></div> <div class="col-sm-6 pull-right"> <a class="watch" name="watch"><i class="fa fa-eye"></i><span class="eyesValue" val="3">3</span></a> <a class="single-stat comments"><i class="fa fa-heart-o"></i>3</a> </div> </div> <div class="col-sm-12 temlatesButtons"> <a class="btn btn-primary btn-sm fixed-bottom box-shadow--2dp col-sm-6 progectLink elementAdd">Add</a> <a class="btn btn-success btn-sm fixed-bottom box-shadow--4dp col-sm-6 sec" href="/progect/element/'+val._id +"/" +val.name + '">View</a> </div> </div> </li>');
           });
       
        });  
    });


    //config add editors
    var addmyCodeMirror = CodeMirror(document.getElementById("add-html") , {
      mode: "htmlmixed",
      theme: "ambiance",
      lineNumbers: true,
      scrollbarStyle: "simple",
      gutter: true,
      extraKeys: {"Ctrl-Space": "autocomplete"},
      onKeyEvent: function (e, s) {
        if (s.type == "keyup") {
           CodeMirror.showHint(e);
        }
      },
      value: $dataHtml
    });

    var addmyCodeMirrorCss = CodeMirror(document.getElementById("add-css") , {
      mode:  "text/css",
      theme: "ambiance",
      lineNumbers: true,
      scrollbarStyle: "simple",
      gutter: true,
      extraKeys: {"Ctrl-Space": "autocomplete"},
      value: $dataCss

    });

    var addmyCodeMirrorJs = CodeMirror(document.getElementById("add-js") , {
      mode:  "text/javascript",
      theme: "ambiance",
      lineNumbers: true,
      scrollbarStyle: "simple",
      extraKeys: {"Ctrl-Space": "autocomplete"},
      value: $dataJs
    });

    $('.addEditor').resizable({
      maxWidth: 750,
      minWidth: 20,
      handles: "e"
    });
    

    //get editor info
    $('#mainEditor').on('keyup', function() {
        //mirror valuses
        var addhtmlValue = addmyCodeMirror.getValue('\n');

        var addcssValue = addmyCodeMirrorCss.getValue('\n');

        var addjsValue = addmyCodeMirrorJs.getValue('\n');


        $('.addhtmlRow').html(addhtmlValue);

        $('.addhtmlcss').find('style').html(addcssValue);

        $('.addhtmljs').find('script').html(addjsValue);


        (function (global) {
            global.localStorage.setItem("addhtml", addhtmlValue);
            global.localStorage.setItem("addcss", addcssValue);
            global.localStorage.setItem("addjs", addjsValue);
        }(window));


    });
     

    // add element to editor
    $('.listElement').on('click' , '.elementAdd' , function(e) {
        
        var htmlRow = $('iframe').contents('.htmlRow').length;
        console.log(htmlRow);
        var parentDiv= $(this).closest('iframe').contents().find('.htmlRow');
        console.log(parentDiv);
        e.preventDefault();
    });



    //hide button save element
    $('.elementSave').hide();
    $('.saveElement').hide();

    //manage show and hide editors
    $('.modal-overlay').on('click' , '.addElement' , function() {
        $(this).removeClass('fa-plus-circle');
        $(this).addClass('fa-minus-circle');
        $(this).addClass('addClose');
        $('#mainEditor').show();
        //show button save element
        $('.elementSave').show();
        $('.saveElement').show();
        $('.modal-menu').hide();
        $('.modal-left').find('iframe').show();
        $('.listElement').hide();
        
    });

    $('.modal-overlay').on('click' , '.addClose' , function() {
        $(this).removeClass('addClose');
        $(this).removeClass('fa-minus-circle');
        $(this).addClass('fa-plus-circle');
        $('#mainEditor').hide();
        $('.saveB').hide();
        $('.modal-menu').show();
        $('.modal-left').find('iframe').hide();
        
    });

    //manage add fullscreen
    $('.modal-overlay').on('click' , '.fullScreen' , function() {
        $(this).removeClass('fa-arrows-alt');
        $(this).addClass('fa-minus-circle');
        $(this).addClass('fullScreenClose');
        $('.modal-overlay').find('.modal-wrapper').css("width" , "98%");
    });

    $('.modal-overlay').on('click' , '.fullScreenClose' , function() {
        $(this).removeClass('fullScreenClose');
        $(this).removeClass('fa-minus-circle');
        $(this).addClass('fa-arrows-alt');
        $('.modal-overlay').find('.modal-wrapper').css("width" , "70%");
    });


    //ajax to data cdn
    $('.modal-left').on('keyup' , '.cdnjs' , function() {
    	
		var keyword = $("#keyword").val();
		$.getJSON("data/cdnjs.json", function(result){
            $.each(result, function(i, field){

                var filter = [];
                if (field.name.indexOf(keyword) > -1) {
                	// console.log(field.name);
                    // $('.ui-autocomplete').after("<li value='"+field.name+"'>"+field.name+" </li>");
                    filter.push(field.name);

                }
                var widget = new AutoComplete('search_bar', filter);
                // $(".ui-autocomplete").after('<ul>');
            });
        });
    });
    
   
    

    var n = "desktop";
    var r = $(window);
    i();
    $(window).resize(i).delay(100);
    $(".mobile-nav").click(function(e) {
        if (n == "phone" && $(this).find("a").hasClass("active") == false) {
            // console.log($(this).find("a").hasClass("active"));
            $(".modal-body").addClass("smenu-active");
            $(this).find("a").addClass("active")
        } else if (n == "phone" && $(this).find("a").hasClass("active")) {
            $(".modal-body").removeClass("smenu-active");
            $(this).find("a").removeClass("active")
        }
    });
    

    $(".modal-body").addClass("desktop-des-non-active");

    $(".smenu-user").click(function(e) {

    	if ($('.modal-menu').css('width') == "30%") {
            alert('wow');
    	}

        if (n == "desktop" && $(this).find("a").hasClass("active")) {
            $(".modal-body").addClass("desktop-des-non-active");
            $(".smenu-user").find("a").removeClass("active")
        } else if (n == "desktop" && $(this).find("a").not("active")) {
            $(".modal-body").removeClass("desktop-des-non-active");
            $('.wrapper-smenu').find('.nav').toggleClass('icons-active-mode');
            $(".smenu-user").find("a").addClass("active")
        }
        if ((n == "mobile" || n == "phone") && $(this).find("a").hasClass("active")) {
            $(".modal-body").removeClass("mobile-des-active");
            $(".smenu-user").find("a").removeClass("active")
        } else if ((n == "mobile" || n == "phone") && $(this).find("a").not("active")) {
            $(".modal-body").addClass("mobile-des-active");
            $(".smenu-user").find("a").addClass("active")
        }
       

    });

    $('.saveElement , .saveElementEdit').on('click',  function() {

        console.log('good');
        var elmentName  =  $('.elementName').val();
        var elementHtml =  addmyCodeMirror.getValue('\n');
        var elementCss  =  addmyCodeMirrorCss.getValue('\n');
        var elementJs   =  addmyCodeMirrorJs.getValue('\n');
        

        var parameters = { elmentName: elmentName , elementHtml: elementHtml , elementCss: elementCss , elementJs: elementJs};
        $.post( '/scanner/element', parameters, function(data) {
           alert(data);
        }); 
    });

 
}

